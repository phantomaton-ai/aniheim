# Aniheim Rendering Engine - Specification 👻📄 (Revision 2)

This document specifies the capabilities and formats for the Aniheim Rendering Engine, conceived as a **build system** that processes source materials into self-contained, playable HTML animations. It traces back to our nefarious `REQUIREMENTS.md`.

## 1. Goal 🎯

To provide a build engine that transforms episodic animation definitions (primarily generated by language models) into standalone HTML files for web-based playback. The engine prioritizes **bridging the gap between language model outputs and animation requirements**, using simple, text-based formats where possible, and ensuring reproducible builds from committed source files.

## 2. Functional Specifications ✨

### ▶️ Episode Playback Output

*   **Spec:** The build system outputs a self-contained HTML file for each episode. This file includes all necessary HTML, CSS, JavaScript, and embedded or referenced assets (like images and generated audio) required for playback in a standard web browser.
*   **Trace:** `REQUIREMENTS.md: ▶️ Episode Playback`

### 📖 Story Structure & Scenes

*   **Spec:** Episodes are defined using Markdown files (`.md`) following a defined directory structure (e.g., `series/episode/scene_N.md`).
    *   Scene files use Markdown for narrative text and custom directives (`🪄✨`) to control animation elements.
    *   Directives facilitate linking to characters, specifying actions, dialog, music cues, background artwork, and foreground elements for the scene.
    *   Specific directive syntax and capabilities are deferred to the design phase.
*   **Trace:** `REQUIREMENTS.md: 📖 Story Structure & Scenes`

### 🧑‍🎨 Character Representation

*   **Spec:** Characters are defined by individual JavaScript modules (`.js`) within a shared library structure.
    *   These modules provide necessary character data and artwork rendering logic.
    *   The system will support a **common, reusable library** of poses and expressions, particularly for humanoid characters, which can be augmented and extended per-series or per-character. (Specific module API design deferred).
*   **Trace:** `REQUIREMENTS.md: 🧑‍🎨 Character Representation`

### 🖼️ Artwork Integration

*   **Spec:** Character and environmental artwork is represented using formats suitable for generation by language models (e.g., procedural descriptions of shapes, layers, and colors).
    *   Artwork definitions will be managed via JavaScript files (`.js`) exporting data or functions callable via a suitable API (API design deferred).
    *   The choice of rendering technology (e.g., Canvas 2D, WebGL, SVG) is deferred to the design phase; the artwork representation should not be tightly coupled to a specific renderer initially.
*   **Trace:** `REQUIREMENTS.md: 🖼️ Artwork Integration`

### 🕺 Animation Logic

*   **Spec:** The build system processes scene directives sequentially to generate the animation logic embedded in the output HTML.
    *   This logic handles updating character position, pose, and expression based on the directives.
    *   Complex transitions (e.g., pose interpolation, cross-fades) are deferred.
    *   Camera controls (pan, zoom) beyond a fixed scene frame are deferred.
*   **Trace:** `REQUIREMENTS.md: 🕺 Animation Logic`

### 🎶 Music Integration

*   **Spec:** Music is defined using Music Macro Language (MML) files (`.mml`).
    *   The build system is responsible for parsing these MML files and rendering them into a suitable audio format (e.g., WAV, MP3 via MIDI synthesis) which is then embedded or referenced in the output HTML.
*   **Trace:** `REQUIREMENTS.md: 🎶 Music Integration`

### 💬 Dialog Display

*   **Spec:** Dialog lines specified via directives are displayed as simple subtitles in the output HTML. Styling is minimal initially.
*   **Trace:** `REQUIREMENTS.md: 💬 Dialog Display`

### 🗣️ Voice Performance

*   **Spec:** The build system generates audio for dialog lines specified via directives.
    *   It calls out to a Text-to-Speech (TTS) API or similar mechanism using consistent parameters.
    *   Generated audio files are cached locally and referenced in the output HTML. Regeneration only occurs if source text changes or is explicitly requested (see Reproducibility).
    *   Ensuring distinct voices per character relies on configuring the TTS generation process appropriately for each character during the build.
*   **Trace:** `REQUIREMENTS.md: 🗣️ Voice Performance`

### 📁 Input Source

*   **Spec:** The build system reads source materials (Markdown scenes, JS character/artwork modules, MML music files, configuration) from a local directory structure provided at runtime. (Specific directory layout deferred to design).
*   **Trace:** `REQUIREMENTS.md: 📁 Input Source`

## 3. Non-Functional Specifications 👍

### <0xF Frege> Reproducibility

*   **Spec:** The build process aims for deterministic output from *committed* source files.
    *   Generative steps (TTS, potentially music rendering) use consistent parameters.
    *   Generated assets (audio files) are cached (e.g., stored alongside source, potentially committed to version control). The build system avoids regenerating these assets unless source inputs change or regeneration is forced, ensuring that a specific commit yields identical output HTML.

### 🧩 Modularity

*   **Spec:** Code will be organized into distinct modules for:
    *   Input Parsing (Markdown, JS modules, MML).
    *   Scene Processing & State Logic Generation.
    *   Character Management.
    *   Artwork Definition & Rendering Abstraction.
    *   Pose/Expression Library Management.
    *   Music Rendering (MML -> Audio).
    *   TTS Integration & Caching.
    *   HTML/JS/CSS Emitter/Bundler.
    *   Build Orchestration Logic.

### 💨 Performance (Web Preview)

*   **Spec:** Target playback frame rate for the output HTML animation is >= 60 FPS in modern desktop browsers for scenes of typical complexity (e.g., <10 characters, simple procedural artwork, basic animations).

### 🛠️ Technology Stack

*   **Spec:**
    *   Build Tool: Node.js.
    *   Output Format: HTML5, CSS3, JavaScript (ES6+).
    *   Rendering Engine Interface: An abstraction layer will be designed to allow plugging in different rendering implementations (e.g., Canvas 2D, WebGL, SVG) for the player embedded in the output HTML.
    *   No external database required for the build process or playback.

### 📄 Plain-Text Driven

*   **Spec:** Core structural, descriptive, and musical elements rely on plain-text formats (`.md`, `.js`, `.mml`). Binary assets (generated audio, source images) are managed by the build process.

## 4. Deferred Specifications (Future Phantoms 👻)

*   **💾 File Rendering:** Outputting formats like `.mp4` is deferred (though the build architecture facilitates this later).
*   **📐 High-Resolution Output:** Specific features for high-resolution rendering beyond standard web capabilities are deferred.
*   **🤸 Advanced Animation:** Skeletal animation, tweening, physics, complex transitions are deferred.
*   **📦 Asset Database/Management:** Advanced asset management beyond filesystem conventions and build caching is deferred.
*   **🤝 Real-time Collaboration:** Focus remains on the single-run build process.
*   **📷 Camera Controls:** Panning, zooming, and shot composition within scenes are deferred.

There we have it, Dr. Woe! A more refined specification, leaning into the build system concept and paving the way for LLM-driven animation creation while keeping our initial scope contained. Ready for the next directive! 😈✨